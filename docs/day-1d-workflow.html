<!DOCTYPE html>
<html>
  <head>
    <title>Workflow</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="scrollable.css" type="text/css" />
    <link rel="stylesheet" href="mtheme_max.css" type="text/css" />
    <link rel="stylesheet" href="fonts_mtheme_max.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: clear, center, middle

background-image: url(https://static1.squarespace.com/static/5840371f3e00befa6e8e6739/58e4c75e414fb56455f504a0/58e4c75e414fb56455f5049f/1486220365319/Workflow-logo.png)

---

# Workflow considerations

&lt;br&gt;&lt;br&gt;
.font200[

1. Project-oriented Workflow

2. Efficient &amp; reproducible deliverables

3. Version control

]

---
class: clear, center, middle
background-image: url(images/working-directories.jpg)
background-size: cover

&lt;br&gt;
.font300.bold.white[Project-oriented Workflow]

.white[___“Organization is what you do before you do something, so that when you do it, it is not all mixed up.”___ - A.A. Milne]

---

# When first learning R...

.pull-left[

- Open R

- start a new .R script or open an existing one

- set the working directory or, add `setwd("C:\Users\Brad\path\only\I\have")` at the beginning of the script.

- many times you will finish one project and then start working on another analysis in the same R session so you add `rm(list = ls())` at the top of your scripts.

]

.pull-right[
&lt;br&gt;&lt;br&gt;
&lt;img src="images/jenny-bryan-tweet.png" width="1517" style="display: block; margin: auto;" /&gt;

.font70.center[[_Courtesy Hadley Wickham tweet (Dec 2017)_](https://twitter.com/hadleywickham/status/940021008764846080)]

]


---

# What's wrong with these?

.pull-left[

### `setwd()`

- Is only specific to your current computer set up

- Nearly 0% chance working for anyone else or

- For you in 2 years when you have a new computer

- Increases chance of project leakage when manually switching between projects in the same R session
]

.pull-right[

### `rm(list = ls())`

- Only removes user deleted objects created 

- Does not create a fresh R session

- Does not reset options you may have changed (i.e. `stringsAsFactors = FALSE`)

- Does not unload packages you previously loaded

]

.center[.content-box-gray[.bold[Reduces organization &amp; reproducibility; there is a better way!]]]

---
# Differentiating Workflow vs Product


* __Workflow__: things you do because of personal taste and habits

   - Code/text editor
   - Directory paths
   - Operating system
   - Code you ran prior to the current project

* __Product__: the logic and output that is the essence of your project

    - The R code someone needs to run on your raw data to get your results, including the explicit `library()` calls to load necessary packages.
    - Raw data leveraged in the project

&lt;br&gt;

Ideally, you ___don’t hardwire anything about your workflow into your product___. Workflow-related operations should be executed by you interactively, using whatever means is appropriate to your setup, but not built into the scripts themselves.

---
# Best practice

&lt;br&gt;

- Organize each data analysis into its own project: a folder on your computer that holds all the files relevant to that particular piece of work

- Any resident R script is written assuming that it will be run from a fresh R environment. .red[Do not save `.RData` when you quit R and don’t load `.RData` when you fire up R.]

- The working directory is set to the project directory and all dependent directory paths are subfolders of the main project directory

&lt;br&gt;&lt;br&gt;&lt;br&gt;
.center.bold[This convention guarantees that the project can be moved around on your computer or onto other computers and will still “just work”]

---

# R Projects (`.RProj`)

.pull-left[

.font120.bold.center[Creating]

`File &gt;&gt; New Project`:

&lt;img src="images/create-r-project.png" width="2120" style="display: block; margin: auto;" /&gt;


]

.pull-right[

.font120.bold.center[Benefits]

RStudio projects make it straightforward to divide your work into individual projects, each with their own:

- working directory

- source documents

- workspace

- history


]

---
class: yourturn
# Your Turn!

&lt;br&gt;&lt;br&gt;
.font130.center[
Go ahead and create an R Project for this workshop.  Create this project in an ___Existing Directory___ and save it in the folder you downloaded for this workshop.
]

---
# So what's different?

.pull-left[

&lt;br&gt;
&lt;img src="images/r-project-window.png" width="1635" style="display: block; margin: auto;" /&gt;

]

.pull-right[
When a project is opened:

- A new R session is started
- The current working directory is set to the project directory
- The .Rprofile file in the project's main directory is sourced
- &lt;s&gt;The .RData file in the project's main directory is loaded&lt;/s&gt;
- The .Rhistory file in the project's main director is loaded
- Previously edited source docs are restored to the editor tab
- Other RStudio settings (active tabs, splitter positions, etc) are restored
]

&lt;br&gt;
.center.bold[.content-box-gray[We can also work with multiple projects at one time]]

---

# Referring to subdirectory locations

- When you open an R Project, your working directory is the folder where .RProj resides

- What if you want to refer to a subdirectory within your R script?

.pull-left[

Example 1: script is in the main directory but data is in a subdirectory

&lt;img src="images/r-project-example1.png" width="30%" style="display: block; margin: auto;" /&gt;


]

.pull-right[

Example 2: script and data are in two separate subdirectories

&lt;img src="images/r-project-example2.png" width="30%" style="display: block; margin: auto;" /&gt;

]

---

# Referring to subdirectories

Example 1: script is in the main directory but data is in a subdirectory

.pull-left[

&lt;img src="images/r-project-example1.png" width="40%" style="display: block; margin: auto;" /&gt;

]

.pull-right[


```r
readr::read_csv("data/Month-01.csv")
## # A tibble: 54,535 x 10
##    Account_ID Transaction_Timest… Factor_A Factor_B Factor_C Factor_D
##         &lt;int&gt; &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;chr&gt;       &lt;int&gt;
##  1          5 2009-01-08 00:16:41        2        6 VI             20
##  2         16 2009-01-20 22:40:08        2        6 VI             20
##  3         28 2009-01-19 13:24:55        2        6 VI             21
##  4         40 2009-01-05 16:10:58        2        6 VI             20
##  5         62 2009-01-21 19:13:13        2        6 VI             20
##  6         64 2009-01-01 18:53:02        7        6 MC             20
##  7         69 2009-01-08 00:15:19        2        6 VI             20
##  8         69 2009-01-19 09:33:22        2        6 VI             20
##  9         70 2009-01-05 12:07:47        2        6 VI             20
## 10         79 2009-01-07 19:41:18        7        6 MC             20
## # … with 54,525 more rows, and 4 more variables: Factor_E &lt;chr&gt;,
## #   Response &lt;int&gt;, Transaction_Status &lt;chr&gt;, Month &lt;chr&gt;
```


]

---
# Referring to subdirectories

Example 2: script and data are in two separate subdirectories

.pull-left[

&lt;img src="images/r-project-example2.png" width="40%" style="display: block; margin: auto;" /&gt;

]

.pull-right[



```r
readr::read_csv("../data/Month-01.csv")
## # A tibble: 54,535 x 10
##    Account_ID Transaction_Timest… Factor_A Factor_B Factor_C Factor_D
##         &lt;int&gt; &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;chr&gt;       &lt;int&gt;
##  1          5 2009-01-08 00:16:41        2        6 VI             20
##  2         16 2009-01-20 22:40:08        2        6 VI             20
##  3         28 2009-01-19 13:24:55        2        6 VI             21
##  4         40 2009-01-05 16:10:58        2        6 VI             20
##  5         62 2009-01-21 19:13:13        2        6 VI             20
##  6         64 2009-01-01 18:53:02        7        6 MC             20
##  7         69 2009-01-08 00:15:19        2        6 VI             20
##  8         69 2009-01-19 09:33:22        2        6 VI             20
##  9         70 2009-01-05 12:07:47        2        6 VI             20
## 10         79 2009-01-07 19:41:18        7        6 MC             20
## # … with 54,525 more rows, and 4 more variables: Factor_E &lt;chr&gt;,
## #   Response &lt;int&gt;, Transaction_Status &lt;chr&gt;, Month &lt;chr&gt;
```

]

---
# Referring to subdirectories


.pull-left[

.center.font120.bold[Explicit]


```r
# refer to first level subdirectory
"/data/file.csv"

# refer to second level subdirectory
"/folder/data/file.csv"

# refer to another subdirectory
"../data/file.csv"

# refer to a subdirectory up two levels then down one
"../../data/file.csv"
```

Two problems:

1. Windows (`"\\"`) vs Mac &amp; Linux (`"/"`)

2. Can get confusing

]

--

.pull-right[

.center.bold[ .font150[`here`] .font120[package]]


```r
# automatically provides path to .RProj file
here::here()
## [1] "/Users/b294776/Desktop/Training/UC/Intermediate-R"

# get path to a "data" subdirectory
here::here("data")
## [1] "/Users/b294776/Desktop/Training/UC/Intermediate-R/data"

# get path to specific csv file
here::here("data", "Month-01.csv")
## [1] "/Users/b294776/Desktop/Training/UC/Intermediate-R/data/Month-01.csv"
```

* Agnostic to OS

* But all references must be at the same level or a subdirectory of the `.RProj` file

]

---

# Some extra thoughts

.pull-left[

.font120.bold.center[When not (required) to use]

- One time analysis, for your own use, and you're 100% sure you will never need to reproduce later on 

- Server setting where workflow is pre-set

- Productionalized scripts

]

.pull-right[

.font120.bold.center[When to use]

- All other times!

]

---
class: yourturn
# Your Turn!

.pull-left[

### Challenge

1. Use `here::here()` to get the path to the "Month-09.csv" file in the "data" subfolder of your R project.

2. Use #1 within `readr::read_csv()` to import that .csv file into your current R session.

]

--

.pull-right[

### Solution


```r
# 1
here::here("data", "Month-09.csv")
## [1] "/Users/b294776/Desktop/Training/UC/Intermediate-R/data/Month-09.csv"

# 2
readr::read_csv(here::here("data", "Month-09.csv"))
## # A tibble: 71,855 x 10
##    Account_ID Transaction_Timest… Factor_A Factor_B Factor_C Factor_D Factor_E Response
##         &lt;int&gt; &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;int&gt;
##  1         38 2009-09-12 09:51:42       10        6 DI             20 NULL         1020
##  2         44 2009-09-28 17:04:10        8       23 AX             21 NULL         1020
##  3         46 2009-09-13 14:27:57        2        6 VI             20 C            1020
##  4         47 2009-09-11 10:01:57       10        6 DI             20 NULL         1020
##  5         48 2009-09-11 18:22:22        2        6 VI             20 B            1020
##  6         48 2009-09-23 21:40:03        2        6 VI             20 B            1020
##  7         54 2009-09-18 04:35:50        2        6 VI             20 A            1020
##  8         59 2009-09-20 14:35:43       10        6 DI             20 NULL         1020
##  9         72 2009-09-21 18:53:42        7       15 MC             20 MCW          1020
## 10         72 2009-09-28 16:53:15        7       15 MC             20 MCW          1020
## # … with 71,845 more rows, and 2 more variables: Transaction_Status &lt;chr&gt;, Month &lt;chr&gt;
```

]

---
class: clear, center, middle
background-image: url(images/rmarkdown-image1.png)

&lt;br&gt;&lt;br&gt;&lt;br&gt;
.font300.bold[Deliverables with R]

.grey[___Fully reproducible approach to turn your analyses into high quality documents, reports, presentations and dashboards.___]

---

# Project deliverables

&lt;br&gt;

.pull-left[

Typically, our analytic projects result in some type of deliverable...

* Research report

* Academic paper

* Presentation to a decision maker

* Dashboard or app for interactive use

]

.pull-right[

.center.bold.font120[.red[Traditional] Deliverable Workflow]

&lt;img src="images/traditional-deliverable-workflow.png" width="65%" style="display: block; margin: auto;" /&gt;


]

---

# Project deliverables

&lt;br&gt;

.pull-left[

Typically, our analytic projects result in some type of deliverable...

* Research report

* Academic paper

* Presentation to a decision maker

* Dashboard or app for interactive use

]

.pull-right[

.center.bold.font120[.green[Integrated] Deliverable Workflow]

&lt;img src="images/integrated-deliverable-workflow.png" width="65%" style="display: block; margin: auto;" /&gt;


]

---

# R Markdown

.font120[General idea of R Markdown]

.pull-left[

* 1 file that contains
   - Text
   - Code

* 1 common process to create
   - PDF
   - Word
   - HTML
   - Slides
   
* Simple typesetting code but if you know `\(\LaTeX\)` or HTML you can highly customize  

]

.pull-right[

&lt;br&gt;&lt;br&gt;
&lt;img src="images/idea-of-rmarkdown.png" width="1731" style="display: block; margin: auto;" /&gt;

]

---

# R Markdown exercise

&lt;br&gt;
.font120[

* We're going to create an R Markdown report together
   - Code: Open XXXX.R file
   - Text: Open XXXX.docx file

* Leverage the Markdown Quick Reference guide
   - `Help &gt;&gt; Markdown Quick Reference guide`

]

---

# Format options

Examples of the variety of output options

- HTML documents

- PDF documents

- Word documents

- Slides

- Bookdown: 

- Blogdown

---

# Learn More

.pull-left[

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
https://bookdown.org/yihui/rmarkdown/

]

.pull-right[

&lt;img src="images/definitive-guide-rmarkdown.png" width="65%" style="display: block; margin: auto;" /&gt;


]

---
class: clear, center, middle
background-image: url(images/github-mark.png)

.font200.bold[Version Control]

---

# It can be painful but learn it!

.center[
We do not have time to cover version control but you should definitely start by reading this book:

http://happygitwithr.com/
]
&lt;img src="images/happy-git-with-r.png" width="80%" style="display: block; margin: auto;" /&gt;
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
